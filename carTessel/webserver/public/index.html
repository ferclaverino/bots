<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tessel Web App</title>
</head>
<body>
  <h1>Hello from Tessel!</h1>
  <p>Press a button to move an car.</p>
  <ul>
    <li>
      <button class="car-button" data-direction="forward">Forward</button>
    </li>
    <li>
      <button class="car-button" data-direction="left">Left</button>
      <button class="car-button" data-direction="right">Right</button>
    </li>
    <li>
      <button class="car-button" data-direction="reverse">Reverse</button>
    </li>
  </ul>
  <p>Press a button to toggle an LED.</p>
  <ul>
    <li>
      <button class="led-button" data-led="2">Green</button>
      Status: <span class="led-status"></span>
    </li>
    <li>
      <button class="led-button" data-led="3">Blue</button>
      Status: <span class="led-status"></span>
    </li>
  </ul>
</body>
<script type="text/javascript">
   // Get a NodeList of elements with the class 'led-button'
   var buttons = document.querySelectorAll('.led-button');

   // Iterate through that Nodelist and add a 'click' EventListener
   Array.prototype.forEach.call(buttons, function (button) {
     button.addEventListener('click', toggleLed);
   });

   // Our event handler function for 'click' event on the LED buttons
   function toggleLed (event) {
     var button = event.target;
     var ledIndex = button.getAttribute('data-led'); // The index of the led in the Tessel.led array
     var statusNode = button.parentNode.querySelector('.led-status'); // The sibling status <span> to update

     fetch('/leds/' + ledIndex)
        .then((response) => response.json())
        .then((response) => {
          statusNode.textContent = response.on ? 'ON' : 'OFF';
        }).catch((e) => {
          console.log('Error', e); // If something went wrong, log that event to the console.
        });;
   }

   // Get a NodeList of elements with the class 'led-button'
   var carButtons = document.querySelectorAll('.car-button');

   Array.prototype.forEach.call(carButtons, function (button) {
     button.addEventListener('mousedown', moveCar);
   });

   Array.prototype.forEach.call(carButtons, function (button) {
     button.addEventListener('mouseup', stopCar);
   });

   // Our event handler function for 'click' event on the LED buttons
   function moveCar (event) {
     var button = event.target;
     var direction = button.getAttribute('data-direction');
     fetch('/car/' + direction);
   }

   function stopCar() {
     fetch('/car/stop');
   }
</script>
</html>
